package keycloak

import (
	"fmt"
	"testing"
)

const (
	stagingHost   = "https://batt-staging.slamit.be/auth/realms/Battmobiel/protocol/openid-connect/certs"
	stagingHeader = "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJEMHFIUXVYeFE0cTFXZExHd18zM3NfalpOZ0VFUzFJUmJoeTdnQXRRTXNrIn0.eyJqdGkiOiIyYzNmZmY5MS1hMmI5LTQyMjYtOGRjNS01OTI4MWExZDIyNTAiLCJleHAiOjE3MjE2NTM0MzAsIm5iZiI6MCwiaWF0IjoxNzIwNDQzODMwLCJpc3MiOiJodHRwczovL2JhdHQtc3RhZ2luZy5zbGFtaXQuYmUvYXV0aC9yZWFsbXMvQmF0dG1vYmllbCIsImF1ZCI6WyJ3ZWIiLCJhY2NvdW50Il0sInN1YiI6IjgwZmVkMjczLTMzZWQtNDRmMS04NDcwLWE1MmY2YmVmYWNkYyIsInR5cCI6IkJlYXJlciIsImF6cCI6IndlYiIsImF1dGhfdGltZSI6MCwic2Vzc2lvbl9zdGF0ZSI6IjYxZWFjNGI1LWUwMDgtNDUyZC1iNmY5LTM3YTliZjRkYmVjNiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiaHR0cHM6Ly9sb2NhbGhvc3Q6NDIwMCIsImh0dHBzOi8vYmF0dC1zdGFnaW5nLnNsYW1pdC5iZSIsIioiLCJodHRwczovL2JhY2tvZmZpY2Utc3RhZ2luZy5iYXR0bW9iaWxpdHkuYmUiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbIm9mZmxpbmVfYWNjZXNzIiwiQmF0dEZ1biIsInVtYV9hdXRob3JpemF0aW9uIiwiQmF0dE1heCIsIkJhdHRGYW4iLCJCYXR0QWRtaW4iXX0sInNjb3BlIjoicHJvZmlsZSByb2xlcyBlbWFpbCIsImVtYWlsX3ZlcmlmaWVkIjpmYWxzZSwicm9sZSI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl0sInJvbGVzIjpbIm9mZmxpbmVfYWNjZXNzIiwiQmF0dEZ1biIsInVtYV9hdXRob3JpemF0aW9uIiwiQmF0dE1heCIsIkJhdHRGYW4iLCJCYXR0QWRtaW4iXSwibmFtZSI6IkNocmlzIERlIEd1eXRlbmFlciIsInByZWZlcnJlZF91c2VybmFtZSI6ImJhdHQiLCJsb2NhbGUiOiJubCIsImdpdmVuX25hbWUiOiJDaHJpcyIsImZhbWlseV9uYW1lIjoiRGUgR3V5dGVuYWVyIiwiZW1haWwiOiJzdXBwb3J0QGJhdHRtb2JpZWwuYmUifQ.b-ukTo5Y3wIvGD39o6rzb4TiSgV6eYCKQtVCBvfszGpU32W2rzsg7lZG-GS5XAM9pgzwNCaBHoFzv0gwzb22CFge7JOGGumdEhrUf1C3CzMWyD1rqArvE-XpPGkhp4_K1MwfK-mSefxul2AN9Xo5XWtZTAxSPQ-ff2d2J8wPlut5s0Vegqs_t3miXzLyqY39DiN2WG3K5cO54UssR58rEB3sTSrel20rl15K8kzOcC7YwDfMmB5hYjRkqhTDsm4ZygpMLBQ5vLWeaWpwU8gp4BjMqoifJ_WbYMIdDC9eTg729VcV5EXx3LmWtl9H3bhG1OkIxwQ0LQUCITOkAwS_0g"
	bogus         = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.5mhBHqs5_DTLdINd9p5m7ZJ6XD0Xc55kIaCRY5r6HRA"
)

func TestKeycloakValidator(t *testing.T) {
	kv, err := NewKeycloakValidator(stagingHost)
	if err != nil {
		t.Fatal(err)
	}
	err = kv.checkHeader(stagingHeader, false)
	fmt.Println(err)
	err = kv.checkHeader(bogus, false)
	fmt.Println(err)
}
